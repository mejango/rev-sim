
<!--
REVNET CALCULATOR - COMPREHENSIVE EXPLAINER
============================================

WHAT IS A REVNET?
-----------------
A Revnet (Revenue Network) is a financial protocol that allows entities to:
1. Invest capital and receive tokens representing ownership
2. Take loans against their token holdings as collateral
3. Generate revenue through fees and interest
4. Cash out tokens for underlying treasury value

CORE MECHANICS:
---------------
1. TOKEN ISSUANCE:
   - New money (investments, revenue) creates new tokens at current issuance price, which starts at 1 token per dollar.
   - Tokens are distributed according to stage splits (e.g., 20% Team 1, 10% Team 2) - ALL split recipients receive their allocated tokens, with any remaining tokens in excess of the total split percent going to the payer of the money that generated the tokens.
   - Issuance price increases over time according to a issuance cut percent and frequency, described in each state.

2. LOAN SYSTEM:
   - Entities can borrow against their token holdings (limited by cash out value of tokens)
   - Loans lock tokens as collateral until repayment
   - Loan potential = cash out value of tokens assuming full treasury (including outstanding loaned amounts) and full token supply (including locked tokens being used as collateral for loans)
   - 2.5% upfront internal fee (goes to treasury as revenue)
   - 3.5% upfront external protocol fee (goes to external entities)
   - Loan principal (loaned amount before upfront fees) can be paid back at any time to access collateral, and must include an additional 5% annual compounding interest after 6-month grace period

3. CASH OUT SYSTEM:
   - Token holders can cash out tokens for treasury value
   - Uses bonding curve: value = (treasury * tokens / supply) * ((1-tax) + tokens*tax/supply), where supply doesn't include locked tokens being used as collateral for loans, and treasury doesn't include outstanding loaned amounts.
   - cash out tax rate is set by the stage (reduces returned value)
   - 5% external protocol fee on cash out amount

4. FEE STRUCTURE:
   - Internal Fees: Revenue to Revnet treasury (2.5% loan origination, interest on repayments)
   - External Protocol Fees: External expenses (3.5% loan origination, 5% cash out)
   - Internal fees generate tokens, external protocol fees don't (they leave the system)
  --->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Revnet Calculator</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js"></script>
</head>
<body>
  <!-- HEADER AND MAIN LAYOUT -->
  <div style="background: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 15px 0; margin-bottom: 20px; width: 100%;">
    <div style="padding: 0 20px; max-width: 800px;">
      <h1 style="margin: 0 0 10px 0; font-size: 1.8em; color: #333;">RevNet Calculator</h1>
      <p style="margin: 0; font-size: 14px; color: #666; line-height: 1.4;">
        <strong>What is a RevNet?</strong> A financial protocol that allows entities to invest capital, receive tokens representing ownership, take loans against their token holdings, generate revenue through fees, and cash out tokens for underlying treasury value.
      </p>
      <p style="margin: 5px 0 0 0; font-size: 14px; color: #666; line-height: 1.4;">
        <strong>How to use:</strong> Choose a scenario from the Scenarios section, customize the Revnet terms if needed, then view the results in the detailed charts below. You can also create custom scenarios by modifying events and saving them.
      </p>
    </div>
  </div>
  <div class="mobile-toggle" onclick="UI.toggleView()">
    <span id="toggle-text">Show Results</span>
  </div>
  <div class="container">
    <div class="controls active">
      <h2 style="margin: 0 0 20px 0; color: #333; font-size: 18px;">Customize</h2>
      <div class="section-divider">
        <div class="collapsible-header" onclick="toggleStages()">
          <div>
            <h3>Revnet terms</h3>
            <p style="font-size: 11px; color: #666; margin: 0;">Configure the revnet's rules for token distribution splits, issuance cuts, and cash out taxes</p>
          </div>
          <span class="toggle-icon">â–¶</span>
        </div>
        <div class="collapsible-content" id="stages-container" style="display: none;">
          <p style="font-size: 11px; color: #666; margin: 5px 0;">Set a stage duration to automatically add the next stage</p>
          <div id="stages"></div>
        </div>
      </div>
      <div class="section-divider">
        <div style="margin-top: 20px;">
          <div class="collapsible-header" onclick="toggleScenarios()">
            <div>
              <h3>Scenarios</h3>
              <p style="font-size: 11px; color: #666; margin: 0;">Choose from predefined scenarios to explore different Revnet strategies</p>
              <div id="selected-scenario-indicator" style="display: none; margin: 10px 0 0 0; padding: 8px; background: #e8f5e8; border: 1px solid #28a745; border-radius: 4px; font-size: 12px;">
                <strong>Selected:</strong> <span id="selected-scenario-name"></span>
              </div>
            </div>
            <span class="toggle-icon">â–¶</span>
          </div>
          <div class="collapsible-content" id="scenarios-container" style="display: none;">
            
            <h4 style="margin: 20px 0 10px 0; color: #333; font-size: 16px;">1. Growth scenarios</h4>
            <p style="font-size: 12px; color: #666; margin: 0 0 15px 0; line-height: 1.4;">Choose a scenario to see how different Revnet growth strategies play out</p>
            <div class="scenario-buttons">
              <button class="scenario-btn investor" onclick="ScenarioManager.loadScenario('conservative-growth')">
                <strong>Conservative Growth</strong><br>
                <small>Steady 10% revenue growth YOY</small>
              </button>
              <button class="scenario-btn investor" onclick="ScenarioManager.loadScenario('hypergrowth')">
                <strong>Hypergrowth</strong><br>
                <small>10x revenue growth YOY</small>
              </button>
              <button class="scenario-btn builder" onclick="ScenarioManager.loadScenario('bootstrap-scale')">
                <strong>Bootstrap to Scale</strong><br>
                <small>Start small, grow organically</small>
              </button>
              <button class="scenario-btn builder" onclick="ScenarioManager.loadScenario('vc-fueled')">
                <strong>VC-Fueled Growth</strong><br>
                <small>Series A, B, C funding rounds</small>
              </button>
              <button class="scenario-btn builder" onclick="ScenarioManager.loadScenario('community-driven')">
                <strong>Community-Driven</strong><br>
                <small>Focus on token splits and incentives</small>
              </button>
              <button class="scenario-btn investor" onclick="ScenarioManager.loadScenario('boom-bust')">
                <strong>Boom-Bust Cycle</strong><br>
                <small>Rapid growth followed by correction</small>
              </button>
            </div>
            
            <h4 style="margin: 30px 0 10px 0; color: #333; font-size: 16px;">2. Operations scenarios</h4>
            <p style="font-size: 12px; color: #666; margin: 0 0 15px 0; line-height: 1.4;">Explore how loans and cashouts can be integrated into the selected growth strategy</p>
            <div class="scenario-buttons" id="capital-access-buttons">
              <!-- Dynamic content will be populated by JavaScript -->
            </div>
            
            <div id="scenario-description" style="display: none; margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 6px; font-size: 13px; line-height: 1.5; border-left: 4px solid #28a745;"></div>
            
            <div style="margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px;">
              <div class="collapsible-header" onclick="toggleEvents()" style="background: #f8f9fa; border-radius: 6px; padding: 12px 15px; margin-bottom: 15px;">
                <div>
                  <h4 style="margin: 0; color: #666; font-size: 14px;">View and customize scenario event sequence</h4>
                  <p style="font-size: 11px; color: #999; margin: 3px 0 0 0;">Configure the sequence of investments, revenue, loans, and cash outs</p>
                </div>
                <span class="toggle-icon" style="font-size: 12px;">â–¶</span>
              </div>
              <div class="collapsible-content" id="events-container" style="display: none;">
                <div id="events"></div>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                  <button class="small" id="save-scenario-btn" style="background: #28a745; color: white; display: none; margin-right: 8px;">ðŸ’¾ Save your scenario</button>
                  <button class="small" id="export-scenario-btn" style="background: #17a2b8; color: white; margin-right: 8px;">ðŸ“¤ Export Scenario</button>
                  <button class="small" id="import-scenario-btn" style="background: #fd7e14; color: white;">ðŸ“¥ Import Scenario</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="results">
      <h2 style="margin: 0 0 20px 0; color: #333; font-size: 18px;">Results</h2>
      <div id="loading" class="loading">Loading...</div>
      <div id="content" style="display: none;">
        <div id="summary"></div>

        <div class="chart-container">
          <div class="chart-wrapper">
            <h4>Cash Flows</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows money flowing in and out of the system from investments, revenue, loans, and cash outs.</p>
            <canvas id="cashFlowChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Token Distribution</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows how tokens are distributed between different splits and payers over time. Each line represents the token balance for that group.</p>
            <canvas id="tokenChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Token Valuations</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the total value of each entity's token holdings over time.</p>
            <canvas id="tokenValuationChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Revnet Treasury Backing</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the total value backing the Revnet treasury over time.</p>
            <canvas id="backingChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Token Cash Out Value</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the value per token when cashing out, based on bonding curve and tax rates.</p>
            <canvas id="cashOutValueChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Loan Potential Comparison</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Compares maximum loan amounts each entity could take based on their token holdings.</p>
            <canvas id="loanPotentialChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Ownership %</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the percentage ownership of total tokens for each entity over time.</p>
            <canvas id="distributionChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Token Performance</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the performance of each entity's token investments over time.</p>
            <canvas id="tokenPerformanceChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Token Issuance Price</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the price for new token issuance based on stage cut rates and frequency.</p>
            <canvas id="issuancePriceChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Loan Status</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows loan amounts for all token holders (splits and investors) over time.</p>
            <canvas id="teamLoanChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Outstanding Loans Comparison</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows current outstanding loan balances for each entity over time.</p>
            <canvas id="outstandingLoansChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Tokens Backing Loans %</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows the percentage of each entity's tokens that are locked as loan collateral.</p>
            <canvas id="dilutionChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h4>Fee Flows</h4>
            <p style="font-size: 11px; color: #666; margin: 5px 0;">Shows internal and protocol fees generated from loans and cash outs.</p>
            <canvas id="cashFlowFeesChart"></canvas>
          </div>

        </div>
        <div id="tableResults"></div>
      </div>
    </div>
  </div>
  <!-- Load all JavaScript files directly -->
  <script src="js/utils.js"></script>
  <script src="js/state.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/stageManager.js"></script>
  <script src="js/eventManager.js"></script>
  <script src="js/calculator.js"></script>
  <script src="js/chartManager.js"></script>
  <script src="js/resultsDisplay.js"></script>
  <script src="js/scenarioManager.js"></script>
  <script src="js/app.js"></script>
  
  <script>
    // Toggle function for collapsible sections
    function toggleStages() {
      const container = document.getElementById('stages-container');
      const toggleIcon = document.querySelector('.collapsible-header .toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggleIcon.textContent = 'â–¼';
        toggleIcon.style.transform = 'rotate(0deg)';
      } else {
        container.style.display = 'none';
        toggleIcon.textContent = 'â–¶';
        toggleIcon.style.transform = '';
      }
    }
    
    function toggleFinalState() {
      const container = document.getElementById('final-state-content');
      const toggleIcon = container.previousElementSibling.querySelector('.toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggleIcon.textContent = 'â–¼';
        toggleIcon.style.transform = 'rotate(0deg)';
      } else {
        container.style.display = 'none';
        toggleIcon.textContent = 'â–¶';
        toggleIcon.style.transform = '';
      }
    }
    
    function toggleSplitAnalytics() {
      const container = document.getElementById('split-analytics-content');
      const toggleIcon = container.previousElementSibling.querySelector('.toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggleIcon.textContent = 'â–¼';
        toggleIcon.style.transform = 'rotate(0deg)';
      } else {
        container.style.display = 'none';
        toggleIcon.textContent = 'â–¶';
        toggleIcon.style.transform = '';
      }
    }
    
    function togglePayerAnalytics() {
      const container = document.getElementById('payer-analytics-content');
      const toggleIcon = container.previousElementSibling.querySelector('.toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggleIcon.textContent = 'â–¼';
        toggleIcon.style.transform = 'rotate(0deg)';
      } else {
        container.style.display = 'none';
        toggleIcon.textContent = 'â–¶';
        toggleIcon.style.transform = '';
      }
    }
    
    function toggleEvents() {
      const container = document.getElementById('events-container');
      const toggleIcon = container.previousElementSibling.querySelector('.toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggleIcon.textContent = 'â–¼';
        toggleIcon.style.transform = 'rotate(0deg)';
      } else {
        container.style.display = 'none';
        toggleIcon.textContent = 'â–¶';
        toggleIcon.style.transform = '';
      }
    }
    
    function toggleScenarios() {
      const container = document.getElementById('scenarios-container');
      const toggleIcon = container.previousElementSibling.querySelector('.toggle-icon');
      
      if (container.style.display === 'none') {
        container.style.display = 'block';
        toggleIcon.textContent = 'â–¼';
        toggleIcon.style.transform = 'rotate(0deg)';
      } else {
        container.style.display = 'none';
        toggleIcon.textContent = 'â–¶';
        toggleIcon.style.transform = '';
      }
    }
    

  </script>
</body>
</html>